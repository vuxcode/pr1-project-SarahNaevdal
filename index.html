<!--This is an interactive book where the user can choose how the story will continue and end-->

<head>
<style>
body {
  font-family: sans-serif; 
  text-align: center;
  background-color: f0f0f0;
  margin: 0;
  padding: 40px 0;
} 

#bookpage {
  background-color: white;
  width: 600px;
  margin: auto;
  padding: 40px;
  box-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  text-align: left;
  min-height: 400px;
  position: relative;
}

#bookpage h2 {
  font-size: 1.2rem;
  line-height: 1.6;
}

.button-area {
  margin-top: 40px;
  display: flex;
  justify-content: space-between;
}

button  {
  padding: 10px 20px;
  font-size: 1rem;
  border: none;
  background-color: #3498db;
  color: white;
  border-radius: 4px;
  cursor: pointer;
}

button:hover {
  background-color: #2980b9;
}

</style><br><br>

<!--Ask the user for their name-->
<form id="nameForm" onsubmit="getInput(event)">
Type your name here:
<!--Create a text box-->
<input id="username" type="text" autocomplete="name">
<!--Add a button for the user to click to confirm the input-->
<button type="submit">Enter</button>
</form></head>

<!--Welcome page-->
<h1 id="hello"></h1>

<div id="bookPage">
<!--Create a text element, that can be updated, to output the text of the book-->
<h2 id="demo"></h2><br><br> 

<!--Buttons-->
<!--Create a button to start the book-->
<button id="startButton" onclick="startAdventure()" style="display: none;">Start the adventure</button>

<!--Create two buttons for the book that can be updated and hidden-->
<!--Give the buttons different id:s-->
<!--Add the same function to both buttons-->
<button id="rightButton" onclick="getPage('right')" style="display: none;">Pups waiting</button>
<button id="leftButton" onclick="getPage('left')" style="display: none;">Tower empty</button>
<div id="pageNumber" style="margin-top: 20px; text-align: center; font-size: 0.9rem; color: #666;"></div> 
</div>

<!--Create a button to restart the book-->
<button id="restartButton" onclick="restart()" style="display: none;">Restart the adventure</button>

<script>

//Save the users input (name) in a variable when the user push 'Enter'.
var playerName = "";

//Create a variable for each page. 
var emptyPage = "";
var welcomePage = "Welcome to your interactive book:<br><p><span style='color: DodgerBlue; font-size: 36px; font-weight: bold;'>PAW PATROL - A NEW LEADER!</span></p><br><br>You will get to chose how the story continues.<br>Press the button below to begin."
let page1 = "<br>It's a beautiful day in Adventure Bay, but Ryder isn't feeling well today. He has a fever and feels dizzy when he tries to stand up.<br>Ryder reaches for his Pup-Pad and calls his good friend Carlos.<br>'Of course I'll help!' says Carlos. 'I'll be right there!'";
var page21 = "<br>Carlos arrives at the Lookout Tower, where all the pups are already waiting.<br>They wag their tails and bark happily when they see Carlos.<br>Suddenly, the alarm goes off! 'A mission already?' says Carlos.<br>The big screen turns on with flashing lights and a loud üö® 'WOO-WOO-WOO!'<br>Carlos stands tall in front of the pups. 'Looks like we've got a mission, pups!' Carlos says.<br>Chase barks, 'PAW Patrol is ready for action, Carlos, sir!'<br><br>Mission A - A Kitten on the Roof!<br>Katie's kitten, Cali, is stuck on top of her vet clinic!<br>She's scared and won't come down.<br><br>Mission B - Trouble at the Bridge!<br>The town's school bus is stuck on a broken bridge.<br>The kids are safe, but they can't get off the bus!";
var page22 = "<br>Carlos arrives at the Lookout Tower ‚Äî but it's completely empty! 'That's strange...' he says.<br>There's no barking, no tails wagging, no pups anywhere.<br>Suddenly, the Pup-Pad beeps.<br>A video message from Chase appears: 'Carlos! We're out on a morning hike with Ryder! But something's wrong. Ryder started feeling worse, and now we can't reach him! His Pup-Pad battery is low!'<br>Carlos gasps. 'I need to find the team - fast!'<br>Carlos has to make a quick decision: Should he:<br><br>Option A - Use the lookout drone to search from the sky<br>Option B - Take the Pup-Mobile and search the trails on land";  
var page31 = "<br>'We need someone who's good at climbing... and someone who's great with cats!'<br>Which two pups should Carlos send?";
var page32 = "<br>'We'll need a strong pup to help fix the bridge‚Ä¶ and one who can help the kids off safely!'<br>Which two pups should Carlos send?";
var page33 = "<br>Carlos activates the lookout tower's drone. It zooms into the sky, scanning the forest.<br>He sees Ryder and the pups near a river, but something's wrong...";
var page34 = "<br>Carlos jumps into the Pup-Mobile and speeds off into the trails.<br>He finds üêæ pawprints and follows them toward the mountains...";
var page41 = "<br>Skye flies up to the roof in her helicopter and gently talks to Cali.<br>Marshall climbs up with the ladder from his fire truck. Together, they make Cali feel safe.<br>She jumps right into Marshall's paws! Everyone cheers!<br>Katie thanks Carlos and says: 'You're a great leader - just like Ryder!'<br><br>Happy Ending: Kitten rescued, team success, Carlos earns a gold star from the pups. ‚≠ê";
var page42 = "<br>Zuma swims around the back of the clinic to call for Cali with a bowl of food.<br>Rubble builds a ramp to the roof - but Cali is too scared to move.<br>In the end, Katie climbs up herself and brings Cali down safely.<br>Carlos says: 'We did our best - next time, I'll choose pups who are better with heights.'<br><br>Learning Ending: Cali is safe, but the team learns about picking the right pups for the job.";
var page43 = "<br>Chase stops traffic using his flashing lights and gives clear commands.<br>Rocky builds a strong ramp from recycled parts.<br>The kids climb down safely from the bus!<br>'PAWsome teamwork!' says Chase.<br><br>Hero Ending: Carlos gets a thank-you from the Mayor, and all the kids give the pups treats! üç¨";
var page44 = "<br>Carlos forgot to check the weather. It started ‚ùÑÔ∏è snowing by the mountain road!<br>Everest slips on the ice, and Rubble doesn't have enough tools to fix the bridge.<br>They can't reach the bus in time - but Chase and Rocky rush in to help!<br>Carlos says: 'We always have to check the weather. Next time, we'll plan better!'<br><br>Cold but Kind Ending: Everyone is safe, and Carlos learns a big lesson in leadership.";
var page45 = "<br>Carlos uses the drone to send their üìç location to Skye and Everest.<br>Skye swoops in and lifts Ryder out safely. He's taken to Katie's clinic and feels better by the afternoon.<br><br>Hero Ending: Carlos saves the day using tech and teamwork!";
var page46 = "<br>Just as the drone finds Ryder, the battery runs out.<br>Carlos panics ‚Äî but then Rubble appears, back from the hike early!<br>Together, they follow the last known location and reach Ryder in time.<br><br>Learning Ending: Tech helps, but backup plans (and teamwork) save the day.";
var page47 = "<br>Carlos uses a üó∫Ô∏è map and the tire tracks to track down the team.<br>Ryder is resting under a tree. Carlos gives him water and calls Katie.<br>Soon, the pups and Ryder are back home, safe and sound.<br><br>Classic Rescue Ending: Carlos becomes a true field leader.";
var page48 = "<br>The Pup-Mobile gets stuck in a muddy path. Carlos can't go further.<br>But Chase hears the Pup-Pad alert and finds Carlos!<br>They work together to finish the search.<br><br>Rescue Assist Ending: Carlos learns that even leaders sometimes need help.";

//Create a variable and connect it to the Hello element.
var helloName = document.getElementById("hello"); 

//Create a variable and connect it to the Demo element. 
var output = document.getElementById("demo");

//Create a variable to find the left button element on the screen.
var left = document.getElementById("leftButton");

//Create a variable to find the right button element on the screen.
var right = document.getElementById("rightButton");

//Find the textbox and connect it to a variable.
var readersName = document.getElementById("username");

var startButton = document.getElementById("startButton");
var restartButton = document.getElementById("restartButton");

//
var pageNumberDisplay = document.getElementById("pageNumber");

//Create an global array
var choices = [];

//Create arrays for all different possible sequences to ger thru the book.
var line1 = [page1, page21, page31, page41];
var line2 = [page1, page21, page31, page42];
var line3 = [page1, page21, page32, page43];
var line4 = [page1, page21, page32, page44];
var line5 = [page1, page22, page33, page45];
var line6 = [page1, page22, page33, page46];
var line7 = [page1, page22, page34, page47];
var line8 = [page1, page22, page34, page48];
//Lenght: 4.

//
var currentLine = line1; 

//Create arrays for the sequences of the buttons.
var seq1 = [right, right, right];
var seq2 = [right, right, left];
var seq3 = [right, left, right];
var seq4 = [right, left, left];
var seq5 = [left, right, right];
var seq6 = [left, right, left];
var seq7 = [left, left, right];
var seq8 = [left, left, left];
//Lenght: 3. 

//Create a variable to access one index in the array.
var index = 0;

//Test!
//for(var index = 0; index < line1.length; index++) {
    //Output the current step.
    //console.log(line1[index]);
//}

//Show the current page number in the console.
        console.log("Empty page")

//Add a function to get the users input (name).
    function getInput(event) {
        //Stop reload.  
        event.preventDefault();
        //Save the users input. Use trim to remove any empty spaces.  
        playerName = readersName.value.trim();

        //?Hide the text-box when the user pushed 'Enter'.
        document.getElementById("nameForm").style.display = "none";

        if (playerName !== "") {
          localStorage.setItem("playerName", playerName);
        }

        //Output the users name on the screen.
        helloName.innerText = "Hello " + playerName + "!";
        //Clear the text box when pushing "Enter". 
        readersName.value = "";
        //Output the first page on the screen.
        output.innerHTML = welcomePage; 
        //Hide the 'Start adventure' button.
        startButton.style.display = "inline-block";
        //Show navigation buttons.
        left.style.display = "none";
        right.style.display = "none";
        restartButton.style.display = "none";
        //Reset index to zero. 
        index = 0; 
        choices = [];
        currentLine = line1;
        //Don't show a page number on this page.
        pageNumberDisplay.innerText = "";
        //Show the input in the console. 
        console.log("Username: " + playerName);
         //Show the chosen page number in the console.
        console.log("Welcome page")
    }

//Add a function for when the user starts the book.
    function startAdventure() {
      //Hide the 'Hello message'. 
      helloName.innerText = "";
      //Make the 'Start' button invisible. 
      startButton.style.display = "none";
      index = 0;
      //Show the first page.
      showPage();
      //Show the navigation buttons. 
      left.style.display = "inline-block";
      right.style.display = "inline-block";
    }
      
//Add a function that lets the user navigate between the pages.
    function getPage(choice) {
        //Save the users choise.
        choices.push(choice);
        
  //Choice one.
        if (choices.length === 1) { 
        //Show page 2 depending on choice.
        if(choice === "right") {
          output.innerHTML = page21.replace(/Carlos/g, playerName);
          left.innerText = "Mission B"; 
          right.innerText = "Mission A";
        }
        else{
          output.innerHTML = page22.replace(/Carlos/g, playerName);
          left.innerText = "Option B"; 
          right.innerText = "Option A";
        }
        
        pageNumberDisplay.innerText = "2.";

        return; //Stop here, don't show the last page yet.
      }
      //Choice two. 
        if (choices.length === 2) {
          const path = choices.join(",");
          if(path === "right,right") currentLine = line1;
          else if(path === "right,left") currentLine = line3;
          else if(path === "left,right") currentLine = line5;
          else if(path === "left,left") currentLine = line7;
          

          index = 2;
          showPage();
          
          //Adjust the buttons.
          if(currentLine[index] === page31) {
          left.innerText = "Zuma & Rubble"; 
          right.innerText = "Marshall & Skye";
          }   
          else if(currentLine[index] === page32) {
          left.innerText = "Everest & Rubble"; 
          right.innerText = "Chase & Rocky";
          }  
          else if(currentLine[index] === page33) {
          left.innerText = "Signal lost"; 
          right.innerText = "Rescue from the air";
          }  
          else if(currentLine[index] === page34) {
          left.innerText = "Gets stuck in mud"; 
          right.innerText = "Tracks down the team";  
          }  
          
          return; //Stop here, don't show the last page yet. 
        }
      //Choice three. Now show the last page.   
        if (choices.length === 3) {
          const path = choices.join(",");

        if (arraysEqual(choices, ["right", "right", "right"])) currentLine = line1;
        else if (arraysEqual(choices, ["right", "right", "left"])) currentLine = line2;
        else if (arraysEqual(choices, ["right", "left", "right"])) currentLine = line3;
        else if (arraysEqual(choices, ["right", "left", "left"])) currentLine = line4;
        else if (arraysEqual(choices, ["left", "right", "right"])) currentLine = line5;
        else if (arraysEqual(choices, ["left", "right", "left"])) currentLine = line6;
        else if (arraysEqual(choices, ["left", "left", "right"])) currentLine = line7;
        else if (arraysEqual(choices, ["left", "left", "left"])) currentLine = line8;

        index = 3; //Start a new story from the beginning.
        showPage();

        //When on the last page: hide the navigation buttons and show the 'restart' button.
          left.style.display = "none";
          right.style.display = "none";
          restartButton.style.display = "inline-block";

          return;
        }
      }
         if (index === currentLine.length -1) {
          left.style.display = "none";
          right.style.display = "none";
          restartButton.style.display = "inline-block";
         }
    
    //Add a function to restart the book.
    function restart() {
        //Reset index and choices.
        index = 0;
        choices = [];
        currentLine = line1;

        //Show the 'welcome' page again.
        output.innerHTML = welcomePage;
        helloName.innerText = "Hello " + playerName + "!";

        //Hide the navigation buttons and show the 'Start' button.
        left.style.display = "none";
        right.style.display = "none";
        restartButton.style.display = "none";
        startButton.style.display = "inline-block";

        //Reset the text of the buttons of page 1. 
        left.innerText = "Tower empty";
        right.innerText = "Pups waiting";
        //Don't show a page number on this page. 
        pageNumberDisplay.innerText = "";
    }

    function arraysEqual(a, b) {
      return a.length === b.length && a.every((val, index) => val === b[index])
    }

//Make a function to update the screen.
function showPage() {
    //Output the current page.
    let currentText = currentLine[index];
    //Show index in the console.
    console.log("index " + index);

    //Replace 'Carlos' with the input from the textbox.
    //Don't replace if the user left the textbox empty when pressing 'Enter'.
    if(playerName !== "") {
    currentText = currentText.replace(/Carlos/g, playerName);
    }
    //Show the text.
    output.innerHTML = currentText;

    const pageLabel = ["1.", "2.", "4."];
    if(index >= 0 && index <= 3) {
      pageNumberDisplay.innerText = pageLabel[index] || "";
    }

    if(index === 0) pageNumberDisplay.innerText = "1.";
    else if(index === 1) pageNumberDisplay.innerText = "2."; 
    else if(index === 2) pageNumberDisplay.innerText = "3.";
    else if(index === 3) pageNumberDisplay.innerText = "4.";
  }
    
  window.onload = function() {
    //Try to get a saved name from local storage.
    let savedName = localStorage.getItem("playerName");
    //
    if(savedName) {
    playerName = savedName;
    //Show the name on the page.
    helloName.innerText = "Welcome back, " + playerName + "!";
    //Put the name in the textbox aswell.
    readersName.value = savedName;
    //Show the 'Start' button immediatly.
    startButton.style.display = "inline-block";
    }
  } 

</script>